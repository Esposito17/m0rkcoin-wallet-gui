<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>M0rkcoin Wallet</title>
    <link href="assets/css/global.css" rel="stylesheet">
    <link href="assets/css/photon.min.css" rel="stylesheet">
</head>
<body>

<div class="main-container">

    <div class="app-sidebar">
        <h1>M0rkcoin</h1>
        <p>
            <span class="small-label"><span class="icon icon-network"></span> Wallet address</span><br>
            <span id="walletAddress" style="word-break: break-all">N/A</span>
            <span id="copyWalletAddress" class="text-btn text-btn-small">COPY</span>
        </p>
        <p>
            <span class="small-label"><span class="icon icon-credit-card"></span> Available Balance</span><br>
            <span id="walletBalanceAvail">N/A</span><br>
            <span class="small-label"><span class="icon icon-lock"></span> Locked</span><br>
            <span id="walletBalanceLocked">N/A</span>
            <br>
            <span id="refreshBalance" class="text-btn text-btn-small">Refresh</span>
        </p>
    </div>

    <input class='hide' type="radio" id="tab-1" name="tractor"/>
    <label for='tab-1' class="label-tab">Send</label>

    <article class='tab-1' id="tab-send">
        <form id="sendForm">
            <div class="form-group">
                <label for="destinationAddress">Recipient Address <span class="red">*</span></label>
                <input type="text" class="form-control" id="destinationAddress" required placeholder="fmrk....">
            </div>
            <div class="form-group">
                <label for="transactionAmount">Amount <span class="red">*</span></label>
                <input type="number" class="form-control" id="transactionAmount" required value="0">
            </div>
            <div class="form-group">
                <label for="paymentId">Payment ID</label>
                <input type="text" class="form-control" id="paymentId" maxlength="64">
            </div>
            <div class="form-group">
                <label for="mixin">Anonymity/Mixin <span class="red">*</span></label>
                <input type="number" class="form-control" id="mixin" required value="0">
            </div>
            <div class="form-group">
                <label for="transactionFee">Fee <span class="red">*</span></label>
                <input type="number" class="form-control" id="transactionFee" required value="0.000001" placeholder="0.000001">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-large btn-positive">Send</button>
                <button type="reset" class="btn btn-large btn-negative">Reset</button>
            </div>
            <div>
                <span id="sendError"></span>
                <span id="sendMessage"></span>
            </div>
        </form>
    </article>

    <input class='hide' type="radio" id="tab-2" name="tractor"/>
    <label for='tab-2' class="label-tab">Transactions</label>

    <article class='tab-2' id="tab-transactions">

    </article>

    <input class='hide' type="radio" id="tab-3" name="tractor" checked='checked'/>
    <label for='tab-3' class="label-tab">Logs</label>

    <article class='tab-3' id="tab-logs">
        <div>
            <label for="daemonConsole">Daemon Logs:</label>
            <textarea style="width: 100%; height: 240px" readonly id="daemonConsole"></textarea>
        </div>
    </article>
</div>

<script>
    // Init
    const electron = require('electron');
    const {ipcRenderer, clipboard} = electron;

    const daemonConsole = document.querySelector('#daemonConsole');

    const sendMessage = document.querySelector("#sendMessage");
    const sendError = document.querySelector("#sendError");

    // UI Interactions
    const copyWalletAddressBtn = document.querySelector("#copyWalletAddress");
    copyWalletAddressBtn.addEventListener('click', () => {
        clipboard.writeText(document.querySelector('#walletAddress').textContent)
    });

    const refreshBalanceBtn = document.querySelector("#refreshBalance");
    refreshBalanceBtn.addEventListener('click', () => {
        ipcRenderer.send('wallet:refreshBalance');
    });

    // Events Out
    const sendForm = document.querySelector('#sendForm');
    sendForm.addEventListener('submit', (event) => {
        event.preventDefault();
        ipcRenderer.send('wallet:transfer', {
            destinationAddress: document.querySelector("#destinationAddress").value,
            amount: Number.parseFloat(document.querySelector("#transactionAmount").value) * 1000000000000,
            paymentId: document.querySelector("#paymentId").value,
            mixin: Number.parseFloat(document.querySelector("#mixin").value),
            transactionFee: Number.parseFloat(document.querySelector("#transactionFee").value) * 1000000000000,
        });
    });

    sendForm.addEventListener('reset', () => {
        sendForm.reset();
    });

    // Events In
    ipcRenderer.on('daemonUpdate', (event, data) => {
        console.log('got daemon update: ' + data.message);
        daemonConsole.value += data.message;
        daemonConsole.scrollTop = daemonConsole.scrollHeight;
    });

    ipcRenderer.on('walletAddress', (event, data) => {
        document.querySelector('#walletAddress').textContent = data.address;
    });

    ipcRenderer.on('walletBalance', (event, data) => {
        let available = Number.parseFloat(data.available / 1000000000000).toFixed(12);
        let locked = Number.parseFloat(data.locked / 1000000000000).toFixed(12);
        document.querySelector('#walletBalanceAvail').textContent = available;
        document.querySelector('#walletBalanceLocked').textContent = locked;
    });

    ipcRenderer.on('walletSendSuccess', (event, data) => {
        sendMessage.textContent = data.message;
        sendError.textContent = "";
        sendForm.reset();
    });

    ipcRenderer.on('walletSendError', (event, data) => {
        sendMessage.textContent = "";
        sendError.textContent = data.message;
    });

</script>
</body>
</html>